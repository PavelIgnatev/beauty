<template>
  <div id="app">
    {{ coords }}
    <vue-dadata
      token="8e14d61356368799079f0d7faf37b4cef48ace2a"
      :onChange="selectSuggestion"
    ></vue-dadata>
    <router-view></router-view>
  </div>
</template>

<script>
import VueDadata from "vue-dadata";
export default {
  name: "VueDadataTest",
  data() {
    return {
      coords: [43, 43],
    };
  },
  created() {
    let coords = JSON.parse(localStorage.getItem("coords"));
    if (coords) {
      this.coords = coords;
    } else {
      this.getLocation();
    }
  },
  methods: {
    selectSuggestion(suggestion) {
      this.coords = [suggestion.data.geo_lat, suggestion.data.geo_lon];
    },
    getLocation() {
      if (!navigator.geolocation) {
        // "Не поддерживаемымый браузер"
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (position) => {
          this.coords = [position.coords.latitude, position.coords.longitude];
        },
        (error) => {
          return error;
        }
      );
    },
  },
  watch: {
    coords() {
      if (this.coords) {
        localStorage.setItem("coords", JSON.stringify(this.coords));
      }
    },
  },
  components: {
    "vue-dadata": VueDadata,
  },
};
</script>
<style lang="sass">
body
  margin: 0
#app
  width: 100vw
  height: 100vh
.ymap-container
  height: 100vh
  width: 50vw
  margin-left: auto
</style>
